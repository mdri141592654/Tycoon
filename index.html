<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Gebrauchtwagenhändler Tycoon</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
        h2 { cursor: pointer; background: #ddd; padding: 10px; margin-top: 10px; }
        .dropdown-content { display: none; background: white; padding: 10px; border: 1px solid #ccc; }
        .vehicle { border: 1px solid #aaa; padding: 10px; margin: 10px 0; background: #fff; }
        .bar { height: 20px; background: #eee; margin: 5px 0; position: relative; }
        .bar-inner { height: 100%; background: green; width: 0%; }
        .status { background: #333; color: white; padding: 10px; position: sticky; top: 0; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="status">
    Kontostand: <span id="money">1000</span> € | Fahrzeuge im Bestand: <span id="inventoryCount">0</span>
</div>

<h2 onclick="toggleDropdown('kaufen')">Fahrzeuge zum Kauf</h2>
<div id="kaufen" class="dropdown-content"></div>

<h2 onclick="toggleDropdown('bestand')">Fahrzeuge im Bestand</h2>
<div id="bestand" class="dropdown-content"></div>

<h2 onclick="toggleDropdown('inseriert')">Inserierte Fahrzeuge</h2>
<div id="inseriert" class="dropdown-content"></div>

<script>
let money = 1000;
let inventory = [];
let listed = [];
let availableCars = [];
let busy = false;

function updateMoney() {
    document.getElementById("money").textContent = money.toFixed(2);
    document.getElementById("inventoryCount").textContent = inventory.length;
}

function toggleDropdown(id) {
    const content = document.getElementById(id);
    content.style.display = content.style.display === "none" ? "block" : "none";
}

function generateCar() {
    const brands = ["Zentra", "Mobilia", "Cartana", "Tiron"];
    const models = ["X100", "Sprinto", "Velox", "Rover", "Luxon"];
    return {
        id: Math.random().toString(36).substr(2, 9),
        name: brands[Math.floor(Math.random() * brands.length)] + " " + models[Math.floor(Math.random() * models.length)],
        optik: Math.floor(Math.random() * 51) + 30,
        technik: Math.floor(Math.random() * 51) + 30,
        reparaturkosten: Math.floor(Math.random() * 200) + 100,
        preis: Math.floor(Math.random() * 300) + 200,
        dauer: Math.random() * 270000 + 30000
    };
}

function updateDropdowns() {
    const kaufenDiv = document.getElementById("kaufen");
    kaufenDiv.innerHTML = "";
    const now = Date.now();

    availableCars = availableCars.filter(car => now < car.expiry);
    while (availableCars.length < 5) {
        const car = generateCar();
        car.expiry = Date.now() + car.dauer;
        availableCars.push(car);
    }

    for (let car of availableCars) {
        const div = document.createElement("div");
        div.className = "vehicle";
        div.innerHTML = `
            <strong>${car.name}</strong><br>
            Preis: ${car.preis} €<br>
            Optik:
            <div class="bar"><div class="bar-inner" style="width:${car.optik}%"></div></div>
            Technik:
            <div class="bar"><div class="bar-inner" style="width:${car.technik}%"></div></div>
            Geschätzte Reparaturkosten: ${car.reparaturkosten} €<br>
            <div class="bar"><div class="bar-inner" style="width:${((car.expiry - now) / car.dauer) * 100}%"></div></div>
            <button onclick="kaufen('${car.id}')">Kaufen</button>
        `;
        kaufenDiv.appendChild(div);
    }

    setTimeout(updateDropdowns, 1000);
}

function kaufen(id) {
    if (busy) return alert("Bitte warte, eine Aktion läuft noch.");
    const car = availableCars.find(c => c.id === id);
    if (!car || money < car.preis) return alert("Nicht genügend Geld.");
    money -= car.preis;
    updateMoney();
    busy = true;
    setTimeout(() => {
        inventory.push({...car});
        updateInventory();
        busy = false;
    }, 3000);
}

function updateInventory() {
    const bestand = document.getElementById("bestand");
    bestand.innerHTML = "";
    for (let i = 0; i < inventory.length; i++) {
        const car = inventory[i];
        const div = document.createElement("div");
        div.className = "vehicle";
        div.innerHTML = `
            <strong>${car.name}</strong><br>
            Optik:
            <div class="bar"><div class="bar-inner" style="width:${car.optik}%"></div></div>
            Technik:
            <div class="bar"><div class="bar-inner" style="width:${car.technik}%"></div></div>
            <button onclick="verbessern(${i}, 'optik')">Optik aufwerten (10€)</button>
            <button onclick="verbessern(${i}, 'technik')">Technik reparieren (${car.reparaturkosten}€)</button>
            <div id="aktion${i}"></div>
            <br><br>
            <label>Inseratspreis: <span id="preislabel${i}">${car.preis + car.reparaturkosten + 50}</span> €</label><br>
            <input type="range" min="${car.preis + car.reparaturkosten}" max="${car.preis + car.reparaturkosten + 500}" value="${car.preis + car.reparaturkosten + 50}" onchange="updateLabel(${i}, this.value)">
            <br>
            <button onclick="inserieren(${i})">Inserieren</button>
        `;
        bestand.appendChild(div);
    }
}

function updateLabel(i, value) {
    document.getElementById("preislabel" + i).textContent = value;
}

function verbessern(index, typ) {
    if (busy) return alert("Eine andere Aktion läuft bereits.");
    const car = inventory[index];
    let kosten = typ === "optik" ? 10 : car.reparaturkosten;
    if (money < kosten) return alert("Nicht genug Geld.");
    if ((typ === "optik" && car.optik >= 100) || (typ === "technik" && car.technik >= 100)) return alert("Bereits maximal verbessert.");
    money -= kosten;
    updateMoney();
    busy = true;
    let target = typ === "optik" ? 'optik' : 'technik';
    let duration = 5000;
    const aktionDiv = document.getElementById("aktion" + index);
    aktionDiv.innerHTML = `<div class="bar"><div class="bar-inner" id="ladebalken${index}" style="width:0%"></div></div>`;
    let start = Date.now();
    let interval = setInterval(() => {
        let percent = ((Date.now() - start) / duration) * 100;
        document.getElementById("ladebalken" + index).style.width = percent + "%";
        if (percent >= 100) {
            clearInterval(interval);
            car[target] = 100;
            busy = false;
            updateInventory();
        }
    }, 100);
}

function inserieren(index) {
    if (busy) return alert("Bitte warte, eine Aktion läuft noch.");
    const car = inventory.splice(index, 1)[0];
    const preis = parseInt(document.getElementById("preislabel" + index).textContent);
    busy = true;
    setTimeout(() => {
        busy = false;
        car.inseratspreis = preis;
        car.verkaufsdauer = Math.max(30000, 300000 - (car.optik + car.technik) * 100 - preis);
        car.startZeit = Date.now();
        listed.push(car);
        updateInventory();
        updateInserate();
    }, 3000);
}

function updateInserate() {
    const inseriert = document.getElementById("inseriert");
    inseriert.innerHTML = "";
    const now = Date.now();
    for (let i = listed.length - 1; i >= 0; i--) {
        const car = listed[i];
        const fortschritt = (now - car.startZeit) / car.verkaufsdauer;
        if (fortschritt >= 1) {
            if (Math.random() < 0.9 || car.inseratspreis < car.preis + car.reparaturkosten + 100) {
                money += car.inseratspreis;
                listed.splice(i, 1);
                updateMoney();
                continue;
            } else {
                inventory.push(car);
                listed.splice(i, 1);
                updateInventory();
                continue;
            }
        }
        const div = document.createElement("div");
        div.className = "vehicle";
        div.innerHTML = `
            <strong>${car.name}</strong><br>
            Inseratspreis: ${car.inseratspreis} €<br>
            <div class="bar"><div class="bar-inner" style="width:${fortschritt * 100}%"></div></div>
        `;
        inseriert.appendChild(div);
    }
    setTimeout(updateInserate, 1000);
}

updateMoney();
updateDropdowns();
updateInventory();
updateInserate();
</script>

</body>
</html>
